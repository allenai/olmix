# Multi-source mixture experiment configuration for olmo2_30m
# Demonstrates mixture optimization across web, academic, and code sources
#
# Usage:
#   olmix launch validate --config configs/examples/mixture_olmo2_30m.yaml
#   olmix launch run --config configs/examples/mixture_olmo2_30m.yaml --dry-run
#   olmix launch run --config configs/examples/mixture_olmo2_30m.yaml

name: olmix-mixture-30m
description: Mixture optimization with web, academic, and code sources
budget: ai2/oe-data
workspace: ai2/dolma2
cluster: ai2/saturn-cirrascale

# Model settings
proxy_model_id: olmo2_30m
tokenizer: dolma2

# Training settings (Chinchilla-based)
# chinchilla_multiple: N means train for N * 20 * params tokens
# For 30M model: 0.83 * 20 * 30M = ~500M tokens per variant
chinchilla_multiple: 0.83
nodes: 1
gpus: 8
variants: 10              # Generate 10 mixture variants
seed: 42

# Mixture generation settings
mix_temperature: 1.0      # Controls diversity of generated mixtures
min_strength: 0.1         # Minimum Dirichlet strength
max_strength: 5.0         # Maximum Dirichlet strength

# Data sources (all dolma2-tokenized)
sources:
  # Web data (DCLM with topic classification)
  - name: dclm
    max_repetition_factor: 1.0
    topics:
      - name: science_math_and_technology
        paths:
          - "s3://ai2-llm/preprocessed/dclm/baseline_topic_ft_lr05_ng2_n3M6_ova_20pct/allenai/dolma2-tokenizer/science_math_and_technology/**/*.npy"
      - name: software_development
        paths:
          - "s3://ai2-llm/preprocessed/dclm/baseline_topic_ft_lr05_ng2_n3M6_ova_20pct/allenai/dolma2-tokenizer/software_development/**/*.npy"
      - name: education_and_jobs
        paths:
          - "s3://ai2-llm/preprocessed/dclm/baseline_topic_ft_lr05_ng2_n3M6_ova_20pct/allenai/dolma2-tokenizer/education_and_jobs/**/*.npy"
      - name: finance_and_business
        paths:
          - "s3://ai2-llm/preprocessed/dclm/baseline_topic_ft_lr05_ng2_n3M6_ova_20pct/allenai/dolma2-tokenizer/finance_and_business/**/*.npy"
      - name: health
        paths:
          - "s3://ai2-llm/preprocessed/dclm/baseline_topic_ft_lr05_ng2_n3M6_ova_20pct/allenai/dolma2-tokenizer/health/**/*.npy"
      - name: history_and_geography
        paths:
          - "s3://ai2-llm/preprocessed/dclm/baseline_topic_ft_lr05_ng2_n3M6_ova_20pct/allenai/dolma2-tokenizer/history_and_geography/**/*.npy"
      - name: literature
        paths:
          - "s3://ai2-llm/preprocessed/dclm/baseline_topic_ft_lr05_ng2_n3M6_ova_20pct/allenai/dolma2-tokenizer/literature/**/*.npy"

  # Academic sources
  - name: arxiv
    paths:
      - "s3://ai2-llm/preprocessed/proof-pile-2/v0_decontaminated-0625_tokenized/arxiv/train/allenai/dolma2-tokenizer/*.npy"
    max_repetition_factor: 2.0

  - name: pes2o
    paths:
      - "s3://ai2-llm/preprocessed/pes2o/allenai/dolma2-tokenizer/*.npy"
    max_repetition_factor: 2.0

  - name: wikipedia
    paths:
      - "s3://ai2-llm/preprocessed/wikipedia-dolma-0823/allenai/dolma2-tokenizer/*.npy"
    max_repetition_factor: 3.0

  # Math
  - name: finemath
    paths:
      - "s3://ai2-llm/preprocessed/olmo3-final/math/allenai/dolma2-tokenizer/finemath_3plus_all/**/*.npy"
    max_repetition_factor: 3.0

  # Code (Stack-Edu)
  - name: stack-edu
    max_repetition_factor: 2.0
    topics:
      - name: python
        paths:
          - "s3://ai2-llm/preprocessed/stack-edu/allenai/dolma2-tokenizer/Python/*.npy"
      - name: javascript
        paths:
          - "s3://ai2-llm/preprocessed/stack-edu/allenai/dolma2-tokenizer/JavaScript/*.npy"
      - name: typescript
        paths:
          - "s3://ai2-llm/preprocessed/stack-edu/allenai/dolma2-tokenizer/TypeScript/*.npy"
      - name: java
        paths:
          - "s3://ai2-llm/preprocessed/stack-edu/allenai/dolma2-tokenizer/Java/*.npy"
      - name: cpp
        paths:
          - "s3://ai2-llm/preprocessed/stack-edu/allenai/dolma2-tokenizer/Cpp/*.npy"
      - name: rust
        paths:
          - "s3://ai2-llm/preprocessed/stack-edu/allenai/dolma2-tokenizer/Rust/*.npy"
      - name: go
        paths:
          - "s3://ai2-llm/preprocessed/stack-edu/allenai/dolma2-tokenizer/Go/*.npy"
      - name: shell
        paths:
          - "s3://ai2-llm/preprocessed/stack-edu/allenai/dolma2-tokenizer/Shell/*.npy"
      - name: sql
        paths:
          - "s3://ai2-llm/preprocessed/stack-edu/allenai/dolma2-tokenizer/SQL/*.npy"
