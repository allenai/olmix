# Quality Upsampling Experiment: heavy_code mix with aggressive quality weighting
# Uses 14M model with 0.5 chinchilla_multiple
# Expected tokens: 0.5 * 20 * 14M = 140M tokens
#
# Mix: heavy_code (science_math_and_technology=20%, software_development=50%, education_and_jobs=15%, politics=5%, adult_content=3%, art_and_design=5%)
# Quality weighting: aggressive (high=70%, med=30%, low=0%)
#
# Usage:
#   olmix launch run --config config/examples/launch/quality_upsampling/heavy_code/aggressive.yaml

name: quality-upsampling-aggressive-heavy-code
description: Quality upsampling experiment - aggressive weighting with heavy code
  mix
infra:
  budget: ai2/oe-base
  workspace: ai2/oe-data
  cluster: ai2/jupiter
  priority: high
  nodes: 1
  gpus: 1
training:
  proxy_model_id: olmo3_14m
  tokenizer: dolma2
  chinchilla_multiple: 0.5
  seed: 42
  global_batch_size: 16
data:
  sources:
  - name: all_dressed
    topics:
    - name: science_math_and_technology
      quality:
      - name: high
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/science_math_and_technology/vigintile_0020/*.npy
      - name: med
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/science_math_and_technology/vigintile_0018/*.npy
      - name: low
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/science_math_and_technology/vigintile_0015/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/science_math_and_technology/vigintile_0016/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/science_math_and_technology/vigintile_0017/*.npy
    - name: software_development
      quality:
      - name: high
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/software_development/vigintile_0020/*.npy
      - name: med
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/software_development/vigintile_0018/*.npy
      - name: low
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/software_development/vigintile_0015/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/software_development/vigintile_0016/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/software_development/vigintile_0017/*.npy
    - name: education_and_jobs
      quality:
      - name: high
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/education_and_jobs/vigintile_0020/*.npy
      - name: med
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/education_and_jobs/vigintile_0018/*.npy
      - name: low
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/education_and_jobs/vigintile_0015/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/education_and_jobs/vigintile_0016/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/education_and_jobs/vigintile_0017/*.npy
    - name: politics
      quality:
      - name: high
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/politics/vigintile_0020/*.npy
      - name: med
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/politics/vigintile_0018/*.npy
      - name: low
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/politics/vigintile_0015/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/politics/vigintile_0016/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/politics/vigintile_0017/*.npy
    - name: adult_content
      quality:
      - name: high
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/adult_content/vigintile_0020/*.npy
      - name: med
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/adult_content/vigintile_0018/*.npy
      - name: low
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/adult_content/vigintile_0015/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/adult_content/vigintile_0016/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/adult_content/vigintile_0017/*.npy
    - name: art_and_design
      quality:
      - name: high
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/art_and_design/vigintile_0020/*.npy
      - name: med
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/art_and_design/vigintile_0018/*.npy
      - name: low
        paths:
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/art_and_design/vigintile_0015/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/art_and_design/vigintile_0016/*.npy
        - s3://ai2-llm/preprocessed/cc_all_dressed/all_dressed_v3/dclm_plus2_vigilantes/allenai/dolma2-tokenizer/art_and_design/vigintile_0017/*.npy
  - name: arxiv
    paths:
    - s3://ai2-llm/preprocessed/proof-pile-2/v0_decontaminated-0625_tokenized/arxiv/train/allenai/dolma2-tokenizer/*.npy
  - name: wikipedia
    paths:
    - s3://ai2-llm/preprocessed/wikipedia-dolma-0823/allenai/dolma2-tokenizer/*.npy
eval:
  type: inloop
  tasks:
    math:
      gsm8k_gold_bpb_5shot: eval/downstream/gsm8k_gold_bpb_5shot (BPB v2)
      minerva_math_algebra_gold_bpb_0shot: eval/downstream/minerva_math_algebra_gold_bpb_0shot
        (BPB v2)
      minerva_math_counting_and_probability_gold_bpb_0shot: eval/downstream/minerva_math_counting_and_probability_gold_bpb_0shot
        (BPB v2)
      minerva_math_geometry_gold_bpb_0shot: eval/downstream/minerva_math_geometry_gold_bpb_0shot
        (BPB v2)
      minerva_math_intermediate_algebra_gold_bpb_0shot: eval/downstream/minerva_math_intermediate_algebra_gold_bpb_0shot
        (BPB v2)
      minerva_math_number_theory_gold_bpb_0shot: eval/downstream/minerva_math_number_theory_gold_bpb_0shot
        (BPB v2)
      minerva_math_prealgebra_gold_bpb_0shot: eval/downstream/minerva_math_prealgebra_gold_bpb_0shot
        (BPB v2)
      minerva_math_precalculus_gold_bpb_0shot: eval/downstream/minerva_math_precalculus_gold_bpb_0shot
        (BPB v2)
    code:
      codex_humaneval_gold_bpb_3shot: eval/downstream/codex_humaneval_gold_bpb_3shot
        (BPB v2)
      codex_mbpp_gold_bpb_3shot: eval/downstream/codex_mbpp_gold_bpb_3shot (BPB v2)
      mt_mbpp_bash_gold_bpb_3shot: eval/downstream/mt_mbpp_bash_gold_bpb_3shot (BPB
        v2)
      mt_mbpp_c_gold_bpb_3shot: eval/downstream/mt_mbpp_c_gold_bpb_3shot (BPB v2)
      mt_mbpp_cpp_gold_bpb_3shot: eval/downstream/mt_mbpp_cpp_gold_bpb_3shot (BPB
        v2)
      mt_mbpp_csharp_gold_bpb_3shot: eval/downstream/mt_mbpp_csharp_gold_bpb_3shot
        (BPB v2)
      mt_mbpp_go_gold_bpb_3shot: eval/downstream/mt_mbpp_go_gold_bpb_3shot (BPB v2)
      mt_mbpp_haskell_gold_bpb_3shot: eval/downstream/mt_mbpp_haskell_gold_bpb_3shot
        (BPB v2)
      mt_mbpp_java_gold_bpb_3shot: eval/downstream/mt_mbpp_java_gold_bpb_3shot (BPB
        v2)
      mt_mbpp_javascript_gold_bpb_3shot: eval/downstream/mt_mbpp_javascript_gold_bpb_3shot
        (BPB v2)
      mt_mbpp_matlab_gold_bpb_3shot: eval/downstream/mt_mbpp_matlab_gold_bpb_3shot
        (BPB v2)
      mt_mbpp_php_gold_bpb_3shot: eval/downstream/mt_mbpp_php_gold_bpb_3shot (BPB
        v2)
      mt_mbpp_python_gold_bpb_3shot: eval/downstream/mt_mbpp_python_gold_bpb_3shot
        (BPB v2)
      mt_mbpp_r_gold_bpb_3shot: eval/downstream/mt_mbpp_r_gold_bpb_3shot (BPB v2)
      mt_mbpp_ruby_gold_bpb_3shot: eval/downstream/mt_mbpp_ruby_gold_bpb_3shot (BPB
        v2)
      mt_mbpp_rust_gold_bpb_3shot: eval/downstream/mt_mbpp_rust_gold_bpb_3shot (BPB
        v2)
      mt_mbpp_scala_gold_bpb_3shot: eval/downstream/mt_mbpp_scala_gold_bpb_3shot (BPB
        v2)
      mt_mbpp_swift_gold_bpb_3shot: eval/downstream/mt_mbpp_swift_gold_bpb_3shot (BPB
        v2)
      mt_mbpp_typescript_gold_bpb_3shot: eval/downstream/mt_mbpp_typescript_gold_bpb_3shot
        (BPB v2)
    qa:
      arc_challenge_test_rc_5shot: eval/downstream/arc_challenge_test_rc_5shot (BPB
        v2)
      arc_easy_test_rc_5shot: eval/downstream/arc_easy_test_rc_5shot (BPB v2)
      hellaswag_rc_5shot: eval/downstream/hellaswag_rc_5shot (BPB v2)
      winogrande_val_rc_5shot: eval/downstream/winogrande_val_rc_5shot (BPB v2)
      csqa_val_rc_5shot: eval/downstream/csqa_val_rc_5shot (BPB v2)
      piqa_val_rc_5shot: eval/downstream/piqa_val_rc_5shot (BPB v2)
      socialiqa_val_rc_5shot: eval/downstream/socialiqa_val_rc_5shot (BPB v2)
      mmlu_stem_val_rc_5shot: eval/downstream/mmlu_stem_val_rc_5shot (BPB v2)
      mmlu_humanities_val_rc_5shot: eval/downstream/mmlu_humanities_val_rc_5shot (BPB
        v2)
      mmlu_social_sciences_val_rc_5shot: eval/downstream/mmlu_social_sciences_val_rc_5shot
        (BPB v2)
      mmlu_other_val_rc_5shot: eval/downstream/mmlu_other_val_rc_5shot (BPB v2)
      mmlu_stem_test_rc_5shot: eval/downstream/mmlu_stem_test_rc_5shot (BPB v2)
      mmlu_humanities_test_rc_5shot: eval/downstream/mmlu_humanities_test_rc_5shot
        (BPB v2)
      mmlu_social_sciences_test_rc_5shot: eval/downstream/mmlu_social_sciences_test_rc_5shot
        (BPB v2)
      mmlu_other_test_rc_5shot: eval/downstream/mmlu_other_test_rc_5shot (BPB v2)
      coqa_bpb_0shot: eval/downstream/coqa_bpb_0shot (BPB v2)
      drop_bpb_5shot: eval/downstream/drop_bpb_5shot (BPB v2)
      jeopardy_bpb_5shot: eval/downstream/jeopardy_bpb_5shot (BPB v2)
      lambada_bpb_0shot: eval/downstream/lambada_bpb_0shot (BPB v2)
      naturalqs_bpb_5shot: eval/downstream/naturalqs_bpb_5shot (BPB v2)
      squad_bpb_5shot: eval/downstream/squad_bpb_5shot (BPB v2)
      basic_skills_arithmetic_rc_5shot: eval/downstream/basic_skills_arithmetic_rc_5shot
        (BPB v2)
      basic_skills_coding_rc_5shot: eval/downstream/basic_skills_coding_rc_5shot (BPB
        v2)
      basic_skills_common_knowledge_rc_5shot: eval/downstream/basic_skills_common_knowledge_rc_5shot
        (BPB v2)
      basic_skills_logical_reasoning_rc_5shot: eval/downstream/basic_skills_logical_reasoning_rc_5shot
        (BPB v2)
      basic_skills_pattern_rc_5shot: eval/downstream/basic_skills_pattern_rc_5shot
        (BPB v2)
      basic_skills_string_operations_rc_5shot: eval/downstream/basic_skills_string_operations_rc_5shot
        (BPB v2)
      lab_bench_dbqa_rc_3shot: eval/downstream/lab_bench_dbqa_rc_3shot (BPB v2)
      lab_bench_protocolqa_rc_3shot: eval/downstream/lab_bench_protocolqa_rc_3shot
        (BPB v2)
      medmcqa_rc_5shot: eval/downstream/medmcqa_rc_5shot (BPB v2)
      medqa_en_rc_5shot: eval/downstream/medqa_en_rc_5shot (BPB v2)
      qasper_yesno_rc_5shot: eval/downstream/qasper_yesno_rc_5shot (BPB v2)
      sciriff_yesno_rc_5shot: eval/downstream/sciriff_yesno_rc_5shot (BPB v2)
mix:
  all_dressed:
    weight: 0.999998
    science_math_and_technology:
      weight: 0.204081
      high:
        weight: 0.700001
        repetition_factor: 1.0
      med:
        weight: 0.299999
        repetition_factor: 1.0
      low:
        weight: 0.0
        repetition_factor: 1.0
    software_development:
      weight: 0.510204
      high:
        weight: 0.7
        repetition_factor: 1.0
      med:
        weight: 0.3
        repetition_factor: 1.0
      low:
        weight: 0.0
        repetition_factor: 1.0
    education_and_jobs:
      weight: 0.153061
      high:
        weight: 0.700002
        repetition_factor: 1.0
      med:
        weight: 0.299998
        repetition_factor: 1.0
      low:
        weight: 0.0
        repetition_factor: 1.0
    politics:
      weight: 0.05102
      high:
        weight: 0.7
        repetition_factor: 1.0
      med:
        weight: 0.3
        repetition_factor: 1.0
      low:
        weight: 0.0
        repetition_factor: 1.0
    adult_content:
      weight: 0.030613
      high:
        weight: 0.699997
        repetition_factor: 1.0
      med:
        weight: 0.300003
        repetition_factor: 1.0
      low:
        weight: 0.0
        repetition_factor: 1.0
    art_and_design:
      weight: 0.05102
      high:
        weight: 0.7
        repetition_factor: 1.0
      med:
        weight: 0.3
        repetition_factor: 1.0
      low:
        weight: 0.0
        repetition_factor: 1.0
  arxiv:
    weight: 1.0e-06
    repetition_factor: 1.5
  wikipedia:
    weight: 1.0e-06
    repetition_factor: 2.0
